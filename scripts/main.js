"use strict";(()=>{var S=Object.defineProperty;var i=(n,e)=>S(n,"name",{value:e,configurable:!0});var d={"D&D5E":{journal:"text.content",item:"system.description.value"},PF2E:{journal:"text.content",item:"system.description.value"}};var s=class{static{i(this,"TranslateAllSettingHandler")}gameSettings=game.settings;settings={targetSystem:{name:"translate-all.settings.game.system.name",hint:"translate-all.settings.game.system.hint",scope:"world",config:!0,type:String,default:"PF2E",choices:{"D&D5E":"D&D 5e",PF2E:"Pathfinder 2e"}},apiKey:{name:"translate-all.settings.apiKey.name",hint:"translate-all.settings.apiKey.hint",scope:"world",config:!0,type:String,default:"",masked:!0},targetLanguage:{name:"translate-all.settings.language.name",hint:"translate-all.settings.language.hint",scope:"world",config:!0,type:String,default:"Italian",masked:!0}};constructor(){}init(){this._registerSettings()}_registerSettings(){this._register("translate-all","targetSystem",this.settings.targetSystem),this._register("translate-all","apiKey",this.settings.apiKey),this._register("translate-all","targetLanguage",this.settings.targetLanguage)}_register(e,t,a){this.gameSettings.register(e,t,a)}static getSetting(e,t){return game.settings.get(e,t)}};var g=class n{static{i(this,"DataHandler")}static getDescription(e,t){let a=s.getSetting("translate-all","targetSystem");if(t==="journal")return n.getDescriptionFromJournal(e,a);if(t==="item")return n.getDescriptionFromItem(e,a)}static getDescriptionFromJournal(e,t){let a=e.object;switch(t){case"PF2E":case"D&D5E":return a.text.content;default:return a.text.content}}static getDescriptionFromItem(e,t){switch(t){case"PF2E":return e.object.system.description.value;case"D&D5E":return e.options.document.system.description.value;default:return}}static getPathToUpdate(e){let t=s.getSetting("translate-all","targetSystem");return d[t][e]}static async getTranslatedDescription(e,t,a,r){let o=n.getDescription(e,a);if(!o){ui?.notifications?.error("No description found for this journal page.");return}let l=n.getPathToUpdate(a);r(e,t,o,l)}};var p=class n{static{i(this,"Translator")}static async translate(e){return await n.translateWithChatGPT(e)}static generatePrompt(e,t,a){return`Translate the following ${e} item/spell description into ${t}:


            Keep the same format and structure, like HTML tags, and do not translate the item name or any specific game terms. 
            Don not add any additional code encapsulation or formatting. Just return the translated text.


            ${a}."`}static async translateWithChatGPT(e){let t,a=s.getSetting("translate-all","apiKey"),r=s.getSetting("translate-all","targetSystem"),o=s.getSetting("translate-all","targetLanguage"),l=n.generatePrompt(r,o,e);try{t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"user",content:l}]})})}catch(m){ui?.notifications?.error(`ChatGPT API call failed. ${m}`)}if(!t?.ok){ui?.notifications?.error("ChatGPT API call failed.");return}return(await t.json()).choices?.[0]?.message?.content??void 0}};var c=class n{static{i(this,"HTMLHandler")}static async translateApp(e,t,a,r){let l=(t instanceof jQuery?t:$(t)).find(".window-header");if(l.find("button.translate-btn").length)return;let u=$(`<button class="translate-btn" style="margin-left: 8px; margin-top: 8px;">
          Translate Description
        </button>`);u.on("click",async()=>{let m=await p.translate(a);if(!m){ui?.notifications?.error("Translation failed or returned empty.");return}await n.updateDescription(e,m,r)}),l.append(u)}static async updateDescription(e,t,a){let r=s.getSetting("translate-all","targetSystem");r==="D&D5E"?await this.update5eDescription(e,t,a):r==="PF2E"&&await this.updatePF2EDescription(e,t,a)}static update5eDescription(e,t,a){e.document.update({[a]:t}),e.render(!0),e.close()}static async updatePF2EDescription(e,t,a){let r=e.object;try{a.includes("system")?await r.update({[a]:t}):await r.updateSource({[a]:t})}catch(o){ui?.notifications?.error(`Error updating item description: ${o}`)}e.object.render(!0),await e.object.sheet?.close(),await e.render(!0),await e.close()}};Hooks.once("init",()=>{if(!game.settings){ui?.notifications?.error("Game settings are not available. This module requires Foundry VTT version 10 or later.");return}new s().init()});Hooks.on("renderJournalPageSheet",async(n,e)=>{g.getTranslatedDescription(n,e,"journal",c.translateApp)});Hooks.on("renderItemSheet",async(n,e)=>{g.getTranslatedDescription(n,e,"item",c.translateApp)});Hooks.on("renderItemSheet5e",async(n,e)=>{g.getTranslatedDescription(n,e,"item",c.translateApp)});})();
//# sourceMappingURL=main.js.map
